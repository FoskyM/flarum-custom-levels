(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{extend:()=>v});const s=flarum.core.compat["common/extenders"];var o=t.n(s);const n=flarum.core.compat["common/models/User"];var r=t.n(n);function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function l(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,a(t,e)}const i=flarum.core.compat["common/Model"];var u=t.n(i),c=function(t){function e(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).name=u().attribute("name"),e.min_exp_required=u().attribute("min_exp_required"),e}return l(e,t),e}(u()),p=function(t){function e(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).user_id=u().attribute("user_id"),e.exp=u().attribute("exp"),e.type=u().attribute("type"),e.relationship=u().attribute("relationship"),e.created_at=u().attribute("created_at"),e}return l(e,t),e}(u());const v=[new(o().Model)(r()).attribute("expLevel").attribute("expPercent").attribute("expTotal").attribute("expNext").attribute("expNextNeed"),(new(o().Store)).add("levels",c).add("exp-logs",p)],f=flarum.core.compat["admin/app"];var d=t.n(f);flarum.core.compat.extend;const g=flarum.core.compat["admin/components/ExtensionPage"];var x=t.n(g);const y=flarum.core.compat["common/components/Button"];var h=t.n(y);const b=flarum.core.compat["admin/components/AdminPage"];var k=t.n(b);const N=flarum.core.compat["common/app"];var F=t.n(N);const _=flarum.core.compat["common/Component"];var T=t.n(_);const C=flarum.core.compat["common/components/Tooltip"];var P=t.n(C);const L=flarum.core.compat["common/utils/extractText"];var S=t.n(L),w=function(t){function e(){return t.apply(this,arguments)||this}l(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e)},s.view=function(){var t,e,s,o=this.attrs.user,n=!1;return t=F().forum.attribute("foskym-custom-levels.levelText")||S()(F().translator.trans("foskym-custom-levels.lib.defaults.level")),e=F().forum.attribute("foskym-custom-levels.expText")||S()(F().translator.trans("foskym-custom-levels.lib.defaults.exp")),s=F().forum.attribute("foskym-custom-levels.expTooltip")||S()(F().translator.trans("foskym-custom-levels.lib.defaults.tooltip")),o.expTotal()<0||o.expPercent()<0||o.expLevel()<0?(n=!0,e=S()(F().translator.trans("foskym-custom-levels.lib.error.calculation"))):(s=(s=(s=(s=s.replace("[expTotal]",o.expTotal())).replace("[expPercent]",o.expPercent())).replace("[nextLevel]",o.expNext())).replace("[expToNextLevel]",o.expNextNeed()),e=e.indexOf("[expTotal]")>-1?e.replace("[expTotal]",o.expTotal()):o.expTotal()+" "+e,t=t.indexOf("[level]")>-1?t.replace("[level]",o.expLevel()):t+" "+o.expLevel()),n?m("div",{class:"CustomLevel-level"},e):m(P(),{text:s},m("div",{class:"CustomLevel-level"},m("span",{class:"CustomLevel-text"},t),m("div",{class:"CustomLevel-bar"},m("div",{class:"CustomLevel-bar-value",style:"width: "+o.expPercent()+"%;"}))))},e}(T());const M=flarum.core.compat["common/helpers/avatar"];var B=t.n(M),D=function(t){function e(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).user=d().session.user,e}l(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e)},s.refresh=function(){var t=this;d().store.find("users",d().session.user.id()).then((function(e){t.user=e,m.redraw()}))},s.header=function(t){return m("[",null)},s.content=function(){var t=d().extensionData.getSettings("foskym-custom-levels");return m("div",{className:"ExtensionPage-settings"},m("div",{className:""},m("div",{className:"Form"},t.map(this.buildSettingComponent.bind(this)),m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.preview")),m("div",{style:"margin-left: 6px"},B()(this.user)),w.component({user:this.user})),this.submitButton())))},s.saveSettings=function(e){var s=this;return t.prototype.saveSettings.call(this,e).then((function(){return s.refresh()}))},e}(k());const O=flarum.core.compat["common/components/Page"];var q=t.n(O);const j=flarum.core.compat["common/components/Modal"];var E=t.n(j);const A=flarum.core.compat["common/utils/Stream"];var R=t.n(A),I=function(t){function e(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).level=void 0,e.fields=[],e.values=void 0,e.loading=!1,e}l(e,t);var s=e.prototype;return s.oninit=function(e){var s=this;t.prototype.oninit.call(this,e),this.level=this.attrs.level,this.fields=["name","min_exp_required"],this.values=this.fields.reduce((function(t,e){return t[e]=R()(s.level[e]()||""),t}),{})},s.className=function(){return"EditLevelModal Modal--large"},s.title=function(){return d().translator.trans("foskym-custom-levels.admin.levels.edit_level")},s.content=function(){var t=this;return m("div",{className:"Modal-body"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"CustomLevels-Columns"},m("div",{className:"CustomLevels-Column"},this.fields.slice(0,parseInt((this.fields.length/2).toFixed(0))).map((function(e){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.levels."+e)),m("input",{className:"FormControl",bidi:t.values[e]}))}))),m("div",{className:"CustomLevels-Column"},this.fields.slice(parseInt((this.fields.length/2).toFixed(0)),this.fields.length).map((function(e){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.levels."+e)),m("input",{className:"FormControl",bidi:t.values[e]}))})))),m("div",{className:"Form-group"},h().component({type:"submit",className:"Button Button--primary Button--block EditLevelModal-save",loading:this.loading},d().translator.trans("core.admin.settings.submit_button")))))},s.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0;var s=this.fields.reduce((function(t,s){return t[s]=e.values[s](),t}),{});this.level.save(s).then((function(){e.loading=!1,m.redraw(),e.hide()}))},e}(E()),z=function(t){function e(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).translationPrefix="foskym-custom-levels.admin.levels.",e.levels=[],e}l(e,t);var s=e.prototype;return s.oninit=function(e){var s=this;t.prototype.oninit.call(this,e),d().store.find("levels").then((function(t){s.levels=t,m.redraw()}))},s.view=function(){var t=this;return m("div",{class:"CustomLevels-levelsPage"},m(".Form-group",[m("table",[m("thead",m("tr",[["name","min_exp_required"].map((function(e){return m("th",d().translator.trans(t.translationPrefix+e))})),m("th")])),m("tbody",[this.levels.map((function(e,s){return m("tr",[["name","min_exp_required"].map((function(t){return m("td",e[t]())})),m("td",[h().component({className:"Button Button--icon",icon:"fas fa-edit",onclick:function(){return t.showEditModal(e)}}),h().component({className:"Button Button--icon",icon:"fas fa-times",onclick:function(){confirm(S()(d().translator.trans(t.translationPrefix+"delete_confirmation")))&&(e.delete(),t.levels.splice(s,1))}})])])})),m("tr",m("td",{colspan:2},h().component({className:"Button Button--block",onclick:function(){d().store.createRecord("levels").save({name:t.levels.length,min_exp_required:0}).then((function(e){t.levels.push(e),t.showEditModal(e)}))}},d().translator.trans(this.translationPrefix+"add_button"))))])])]))},s.showEditModal=function(t){d().modal.show(I,{level:t})},e}(q()),U=function(t){function e(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).translationPrefix="foskym-custom-levels.admin.pages.",e.pages={index:D,levels:z},e.icons={index:"home",levels:"list"},e}l(e,t);var s=e.prototype;return s.content=function(){var t=m.route.param().page||"index";return m("div",{className:"ExtensionPage-settings CustomLevels"},m("div",{className:"CustomLevels-menu"},m("div",{className:"container"},this.menuButtons(t))),m("div",{className:"container CustomLevels-container"},this.pageContent(t)))},s.menuButtons=function(t){var e=this;return Object.keys(this.pages).map((function(s){return h().component({className:"Button "+(t===s?"item-selected":""),onclick:function(){return m.route.set(d().route("extension",{id:"foskym-custom-levels",page:s}))},icon:e.iconForPage(s)},d().translator.trans(e.translationPrefix+s))}))},s.iconForPage=function(t){return"fas fa-"+this.icons[t]||0},s.pageContent=function(t){var e=this.pages[t];return e?m(e,null):null},e}(x());const G=flarum.core.compat["common/components/LinkButton"];var H=t.n(G);d().initializers.add("foskym/flarum-custom-levels",(function(){d().extensionData.for("foskym-custom-levels").registerPage(U).registerSetting((function(){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.settings.levelText")),m("div",{class:"helpText"},d().translator.trans("foskym-custom-levels.admin.settings.levelDesc")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-custom-levels.levelText"),placeholder:d().translator.trans("foskym-custom-levels.lib.defaults.level")}))})).registerSetting((function(){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.settings.expText")),m("div",{class:"helpText"},d().translator.trans("foskym-custom-levels.admin.settings.expDesc")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-custom-levels.expText"),placeholder:d().translator.trans("foskym-custom-levels.lib.defaults.exp")}))})).registerSetting((function(){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.settings.expTooltip")),m("div",{class:"helpText"},d().translator.trans("foskym-custom-levels.admin.settings.expTooltipDesc")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-custom-levels.expTooltip"),placeholder:d().translator.trans("foskym-custom-levels.lib.defaults.tooltip")}))})).registerPermission({icon:"fas fa-level-up-alt",label:d().translator.trans("foskym-custom-levels.admin.permissions.edit_exp"),permission:"user.edit_exp"},"moderate"),"xypp-forum-quests"in flarum.extensions?d().extensionData.for("foskym-custom-levels").registerSetting((function(){return m("div",{className:"Form-group"},m(H(),{href:d().route("extension",{id:"xypp-forum-quests"})},d().translator.trans("foskym-custom-levels.admin.go_to_forum_quests")))})):d().extensionData.for("foskym-custom-levels").registerSetting((function(){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.settings.expForPost")),m("div",{class:"helpText"},d().translator.trans("foskym-custom-levels.admin.settings.expForPostDesc")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-custom-levels.expForPost")}))})).registerSetting((function(){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.settings.postMinLength")),m("input",{type:"number",className:"FormControl",bidi:this.setting("foskym-custom-levels.postMinLength")}))})).registerSetting((function(){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.settings.postMaxTimes")),m("input",{type:"number",className:"FormControl",bidi:this.setting("foskym-custom-levels.postMaxTimes")}))})).registerSetting((function(){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.settings.expForDiscussion")),m("div",{class:"helpText"},d().translator.trans("foskym-custom-levels.admin.settings.expForDiscussionDesc")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-custom-levels.expForDiscussion")}))})).registerSetting((function(){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.settings.discussionMaxTimes")),m("input",{type:"number",className:"FormControl",bidi:this.setting("foskym-custom-levels.discussionMaxTimes")}))})).registerSetting((function(){return m("div",{className:"Form-group"},m("label",null,d().translator.trans("foskym-custom-levels.admin.settings.expForLike")),m("div",{class:"helpText"},d().translator.trans("foskym-custom-levels.admin.settings.expForLikeDesc")),m("input",{type:"text",className:"FormControl",bidi:this.setting("foskym-custom-levels.expForLike")}))})).registerSetting({setting:"foskym-custom-levels.autoRemove",label:d().translator.trans("foskym-custom-levels.admin.settings.autoRemove"),type:"select",options:{0:d().translator.trans("foskym-custom-levels.admin.auto_remove.0"),1:d().translator.trans("foskym-custom-levels.admin.auto_remove.1"),2:d().translator.trans("foskym-custom-levels.admin.auto_remove.2")},default:"1"}).registerSetting({setting:"foskym-custom-levels.cascadeRemove",label:d().translator.trans("foskym-custom-levels.admin.settings.cascadeRemove"),type:"checkbox"})}))})(),module.exports=e})();
//# sourceMappingURL=admin.js.map