(()=>{var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{extend:()=>f});const o=flarum.core.compat["common/extenders"];var r=e.n(o);const n=flarum.core.compat["common/models/User"];var a=e.n(n);function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}const c=flarum.core.compat["common/Model"];var u=e.n(c),i=function(e){function t(){for(var t,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))||this).name=u().attribute("name"),t.min_exp_required=u().attribute("min_exp_required"),t}return l(t,e),t}(u()),p=function(e){function t(){for(var t,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))||this).user_id=u().attribute("user_id"),t.exp=u().attribute("exp"),t.type=u().attribute("type"),t.relationship=u().attribute("relationship"),t.created_at=u().attribute("created_at"),t}return l(t,e),t}(u());const f=[new(r().Model)(a()).attribute("expLevel").attribute("expPercent").attribute("expTotal").attribute("expNext").attribute("expNextNeed"),(new(r().Store)).add("levels",i).add("exp-logs",p)],d=flarum.core.compat["forum/app"];var v=e.n(d);const x=flarum.core.compat["common/extend"],y=flarum.core.compat["forum/components/UserPage"];var h=e.n(y);const g=flarum.core.compat["forum/components/PostUser"];var b=e.n(g);const _=flarum.core.compat["forum/components/UserCard"];var k=e.n(_);const T=flarum.core.compat["forum/components/CommentPost"];var L=e.n(T);flarum.core.compat["common/models/Post"];const P=flarum.core.compat["common/components/LinkButton"];var O=e.n(P);const w=flarum.core.compat["forum/components/NotificationGrid"];var N=e.n(w);const C=flarum.core.compat["common/app"];var U=e.n(C);const j=flarum.core.compat["common/Component"];var M=e.n(j);const S=flarum.core.compat["common/components/Tooltip"];var R=e.n(S);const q=flarum.core.compat["common/utils/extractText"];var B=e.n(q),I=function(e){function t(){return e.apply(this,arguments)||this}l(t,e);var o=t.prototype;return o.oninit=function(t){e.prototype.oninit.call(this,t)},o.view=function(){var e,t,o,r=this.attrs.user,n=!1;return e=U().forum.attribute("foskym-custom-levels.levelText")||B()(U().translator.trans("foskym-custom-levels.lib.defaults.level")),t=U().forum.attribute("foskym-custom-levels.expText")||B()(U().translator.trans("foskym-custom-levels.lib.defaults.exp")),o=U().forum.attribute("foskym-custom-levels.expTooltip")||B()(U().translator.trans("foskym-custom-levels.lib.defaults.tooltip")),r.expTotal()<0||r.expPercent()<0||r.expLevel()<0?(n=!0,t=B()(U().translator.trans("foskym-custom-levels.lib.error.calculation"))):(o=(o=(o=(o=o.replace("[expTotal]",r.expTotal())).replace("[expPercent]",r.expPercent())).replace("[nextLevel]",r.expNext())).replace("[expToNextLevel]",r.expNextNeed()),t=t.indexOf("[expTotal]")>-1?t.replace("[expTotal]",r.expTotal()):r.expTotal()+" "+t,e=e.indexOf("[level]")>-1?e.replace("[level]",r.expLevel()):e+" "+r.expLevel()),n?m("div",{class:"CustomLevel-level"},t):m(R(),{text:o},m("div",{class:"CustomLevel-level"},m("span",{class:"CustomLevel-text"},e),m("div",{class:"CustomLevel-bar"},m("div",{class:"CustomLevel-bar-value",style:"width: "+r.expPercent()+"%;"}))))},t}(M());const A=flarum.core.compat["common/components/LoadingIndicator"];var E=e.n(A);const z=flarum.core.compat["common/components/Placeholder"];var G=e.n(z);const D=flarum.core.compat["common/components/Button"];var F=e.n(D);const H=flarum.core.compat["common/utils/humanTime"];var J=e.n(H),K=function(e){function t(){for(var t,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))||this).records=[],t.loading=!0,t.nomore=!1,t.page=0,t}l(t,e);var o=t.prototype;return o.oninit=function(t){e.prototype.oninit.call(this,t),this.loadUser(m.route.param("username")),this.loadRecords()},o.loadRecords=function(){var e=this;v().store.find("exp-logs",{page:this.page}).then((function(t){e.records=e.records.concat(t),console.log(e.records),e.loading=!1,t.length<10&&(e.nomore=!0),m.redraw()}))},o.loadMore=function(){this.page+=1,this.loadRecords()},o.content=function(){var e=this;if(0===this.records.length)return m(G(),{text:v().translator.trans("foskym-custom-levels.forum.log.no_records")});var t="";return v().forum.attribute("foskym-custom-levels.levelText")||B()(v().translator.trans("foskym-custom-levels.lib.defaults.level")),t=v().forum.attribute("foskym-custom-levels.expText")||B()(v().translator.trans("foskym-custom-levels.lib.defaults.exp")),v().forum.attribute("foskym-custom-levels.expTooltip")||B()(v().translator.trans("foskym-custom-levels.lib.defaults.tooltip")),m("div",{className:"ExpLogPage"},m("ul",{className:"ExpLogRecords"},this.records.map((function(e){return m("li",{className:"ExpLogRecord"},m("h5",null,m("span",null,(e.exp()>0?"+":"")+(t.indexOf("[expTotal]")>-1?t.replace("[expTotal]",e.exp()):e.exp()+" "+t)),m("span",null,J()(e.created_at()))),m("p",null,v().translator.trans("foskym-custom-levels.forum.log.type."+e.type()),m("span",null,e.relationship().post_id?m("a",{href:"/d/"+e.relationship().discussion_id+"/"+e.relationship().post_number,target:"_blank"},v().translator.trans("foskym-custom-levels.forum.log.view")):e.relationship().discussion_id?m("a",{href:"/d/"+e.relationship().discussion_id,target:"_blank"},v().translator.trans("foskym-custom-levels.forum.log.view")):"forum_quests"===e.type()?m("a",{href:"/quest_page",target:"_blank"},v().translator.trans("foskym-custom-levels.forum.log.view")):"")),m("hr",null))}))),this.loading&&m(E(),{display:"block"}),!this.loading&&!this.nomore&&m("div",{style:"text-align:center;padding:20px"},m(F(),{className:"Button Button--primary",disabled:this.loading,loading:this.loading,onclick:function(){return e.loadMore()}},v().translator.trans("foskym-custom-levels.forum.log.load_more"))),this.nomore&&m(G(),{text:v().translator.trans("foskym-custom-levels.forum.log.no_more")}))},t}(h());const Q=flarum.core.compat["forum/components/Notification"];var V=e.n(Q);flarum.core.compat["common/helpers/username"];var W=function(e){function t(){return e.apply(this,arguments)||this}l(t,e);var o=t.prototype;return o.icon=function(){return"fas fa-level-up-alt"},o.href=function(){var e=this.attrs.notification.fromUser();return v().route("user.expLogs",{username:e.username()})},o.content=function(){var e,t=this.attrs.notification.content()||{};return e=(e=v().forum.attribute("foskym-custom-levels.levelText")||B()(v().translator.trans("foskym-custom-levels.lib.defaults.level"))).indexOf("[level]")>-1?e.replace("[level]",t.level):e+" "+t.level,v().translator.trans("foskym-custom-levels.forum.notifications.level_updated",{level:e})},t}(V());v().initializers.add("foskym/flarum-custom-levels",(function(){v().notificationComponents.levelUpdated=W,(0,x.extend)(N().prototype,"notificationTypes",(function(e){e.add("levelUpdated",{name:"levelUpdated",icon:"fas fa-level-up-alt",label:v().translator.trans("foskym-custom-levels.forum.settings.notify_level_updated")})})),v().routes["user.expLogs"]={path:"/u/:username/expLogs",component:K},(0,x.extend)(h().prototype,"navItems",(function(e){v().session.user&&v().session.user.id()===this.user.id()&&e.add("expLogs",O().component({href:v().route("user.expLogs",{username:this.user.username()}),icon:"fas fa-level-up-alt"},[v().translator.trans("foskym-custom-levels.forum.label.exp_logs")]))})),(0,x.extend)(b().prototype,"view",(function(e){var t=this.attrs.post.user();t&&e.children.push(I.component({user:t}))})),(0,x.extend)(L().prototype,"headerItems",(function(e){var t=this.attrs.post.user();t&&e.add("custom-levels",I.component({user:t}),10)})),(0,x.extend)(k().prototype,"infoItems",(function(e){var t=this.attrs.user;t&&e.add("custom-levels",I.component({user:t}),50)}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map